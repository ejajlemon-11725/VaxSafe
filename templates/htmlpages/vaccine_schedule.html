{% extends "base_log.html" %}
{% load static %}

{% block title %}Vaccine Schedule - VaxSafe{% endblock %}

{% block content %}
<div class="vaccine-schedule-page">
  <!-- Page Header -->
  <div class="schedule-header">
    <h2>ðŸ’‰ Vaccination Schedule</h2>
    <p class="subtitle">Track and manage your family's vaccine records</p>
  </div>

  <!-- Action Buttons -->
  <div class="schedule-actions">
    <a href="{% url 'add_vaccine' %}" class="action-btn btn-add">
      <i class="fa fa-plus-circle"></i> Add New Vaccine
    </a>
    <button class="action-btn btn-filter" onclick="toggleFilters()">
      <i class="fa fa-filter"></i> Filter
    </button>
    <button class="action-btn btn-export">
      <i class="fa fa-download"></i> Export
    </button>
  </div>

  <!-- Filter Panel (Hidden by default) -->
  <div class="filter-panel" id="filterPanel" style="display: none;">
    <div class="filter-options">
      <select class="filter-select" id="statusFilter">
        <option value="all">All Status</option>
        <option value="Scheduled">Scheduled</option>
        <option value="Completed">Completed</option>
        <option value="Overdue">Overdue</option>
      </select>

      <select class="filter-select" id="memberFilter">
        <option value="all">All Members</option>
        <option value="self">Self</option>
        {% for member in family_members %}
          <option value="{{ member.id }}">{{ member.name }}</option>
        {% endfor %}
      </select>

      <button class="filter-btn" onclick="applyFilters()">Apply</button>
      <button class="filter-btn-clear" onclick="clearFilters()">Clear</button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card stat-upcoming">
      <div class="stat-icon">
        <i class="fa fa-calendar-alt"></i>
      </div>
      <div class="stat-content">
        <h3>{{ upcoming_count }}</h3>
        <p>Upcoming</p>
      </div>
    </div>

    <div class="stat-card stat-completed">
      <div class="stat-icon">
        <i class="fa fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ completed_count }}</h3>
        <p>Completed</p>
      </div>
    </div>

    <div class="stat-card stat-overdue">
      <div class="stat-icon">
        <i class="fa fa-exclamation-triangle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ overdue_count }}</h3>
        <p>Overdue</p>
      </div>
    </div>

    <div class="stat-card stat-total">
      <div class="stat-icon">
        <i class="fa fa-syringe"></i>
      </div>
      <div class="stat-content">
        <h3>{{ total_count }}</h3>
        <p>Total Records</p>
      </div>
    </div>
  </div>

  <!-- Upcoming Vaccines Section -->
  {% if upcoming_vaccines %}
  <section class="vaccines-section">
    <h3 class="section-title">
      <i class="fa fa-clock"></i> Upcoming Vaccines
    </h3>
    <div class="vaccines-grid">
      {% for vaccine in upcoming_vaccines %}
      <div class="vaccine-card vaccine-upcoming" data-status="{{ vaccine.status }}">
        <div class="vaccine-card-header">
          <div class="vaccine-type-badge">{{ vaccine.name }}</div>
          <div class="vaccine-status status-{{ vaccine.status|lower }}">
            {{ vaccine.status }}
          </div>
        </div>

        <div class="vaccine-card-body">
          <div class="vaccine-info">
            <div class="info-row">
              <i class="fa fa-user"></i>
              <span>{{ vaccine.get_recipient_name }}</span>
            </div>
            <div class="info-row">
              <i class="fa fa-calendar"></i>
              <span>{{ vaccine.date_administered|date:"F d, Y" }}</span>
            </div>
            <div class="info-row">
              <i class="fa fa-prescription-bottle"></i>
              <span>Dose: {{ vaccine.dose_number }}</span>
            </div>
            {% if vaccine.location %}
            <div class="info-row">
              <i class="fa fa-map-marker-alt"></i>
              <span>{{ vaccine.location }}</span>
            </div>
            {% endif %}
          </div>

          {% if vaccine.days_until >= 0 %}
          <div class="vaccine-countdown">
            <span class="countdown-number">{{ vaccine.days_until }}</span>
            <span class="countdown-text">days until</span>
          </div>
          {% endif %}
        </div>

        <div class="vaccine-card-footer">
          <a href="{% url 'edit_vaccine' vaccine.id %}" class="card-btn btn-edit">
            <i class="fa fa-edit"></i> Edit
          </a>
          <a href="{% url 'delete_vaccine' vaccine.id %}"
             class="card-btn btn-delete"
             onclick="return confirm('Delete this vaccine record?')">
            <i class="fa fa-trash"></i> Delete
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Past Vaccines Section -->
  {% if past_vaccines %}
  <section class="vaccines-section">
    <h3 class="section-title">
      <i class="fa fa-history"></i> Past Vaccines
    </h3>
    <div class="vaccines-grid">
      {% for vaccine in past_vaccines %}
      <div class="vaccine-card vaccine-past" data-status="{{ vaccine.status }}">
        <div class="vaccine-card-header">
          <div class="vaccine-type-badge">{{ vaccine.name }}</div>
          <div class="vaccine-status status-{{ vaccine.status|lower }}">
            {{ vaccine.status }}
          </div>
        </div>

        <div class="vaccine-card-body">
          <div class="vaccine-info">
            <div class="info-row">
              <i class="fa fa-user"></i>
              <span>{{ vaccine.get_recipient_name }}</span>
            </div>
            <div class="info-row">
              <i class="fa fa-calendar"></i>
              <span>{{ vaccine.date_administered|date:"F d, Y" }}</span>
            </div>
            <div class="info-row">
              <i class="fa fa-prescription-bottle"></i>
              <span>Dose: {{ vaccine.dose_number }}</span>
            </div>
            {% if vaccine.manufacturer %}
            <div class="info-row">
              <i class="fa fa-industry"></i>
              <span>{{ vaccine.manufacturer }}</span>
            </div>
            {% endif %}
          </div>

          {% if vaccine.notes %}
          <div class="vaccine-notes">
            <i class="fa fa-sticky-note"></i>
            <p>{{ vaccine.notes|truncatewords:15 }}</p>
          </div>
          {% endif %}
        </div>

        <div class="vaccine-card-footer">
          <a href="{% url 'edit_vaccine' vaccine.id %}" class="card-btn btn-edit">
            <i class="fa fa-edit"></i> Edit
          </a>
          <a href="{% url 'delete_vaccine' vaccine.id %}"
             class="card-btn btn-delete"
             onclick="return confirm('Delete this vaccine record?')">
            <i class="fa fa-trash"></i> Delete
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Empty State -->
  {% if not upcoming_vaccines and not past_vaccines %}
  <div class="empty-state">
    <div class="empty-icon">
      <i class="fa fa-syringe"></i>
    </div>
    <h3>No Vaccine Records Yet</h3>
    <p>Start tracking your family's vaccinations by adding your first vaccine record.</p>
    <a href="{% url 'add_vaccine' %}" class="btn-empty-action">
      <i class="fa fa-plus-circle"></i> Add First Vaccine
    </a>
  </div>
  {% endif %}
</div>

<!-- Styles -->
<style>
/* ========================================
   VACCINE SCHEDULE PAGE - Modern Design
   ======================================== */

.vaccine-schedule-page {
  padding: 40px 60px;
  background: linear-gradient(135deg, #b0fedc 0%, #c5d2f4 100%);
  min-height: calc(100vh - 80px);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Page Header */
.schedule-header {
  text-align: center;
  margin-bottom: 40px;
}

.schedule-header h2 {
  font-size: 42px;
  font-weight: 800;
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 10px;
}

.schedule-header .subtitle {
  font-size: 18px;
  color: #636e72;
  margin: 0;
}

/* Action Buttons */
.schedule-actions {
  display: flex;
  gap: 15px;
  justify-content: center;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.action-btn {
  padding: 14px 28px;
  border: none;
  border-radius: 25px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.btn-add {
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
  color: white;
}

.btn-add:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 180, 216, 0.4);
}

.btn-filter {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-filter:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.btn-export {
  background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
  color: white;
}

.btn-export:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(11, 163, 96, 0.4);
}

/* Filter Panel */
.filter-panel {
  background: white;
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 30px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.filter-options {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  align-items: center;
}

.filter-select {
  padding: 12px 20px;
  border: 2px solid #e1e8ed;
  border-radius: 12px;
  font-size: 14px;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 1;
  min-width: 150px;
}

.filter-select:focus {
  outline: none;
  border-color: #00b4d8;
  box-shadow: 0 0 0 4px rgba(0, 180, 216, 0.15);
}

.filter-btn,
.filter-btn-clear {
  padding: 12px 24px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.filter-btn {
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
  color: white;
}

.filter-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 180, 216, 0.3);
}

.filter-btn-clear {
  background: #f8f9fa;
  color: #636e72;
  border: 2px solid #e1e8ed;
}

.filter-btn-clear:hover {
  background: #e9ecef;
}

/* Statistics Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 15px;
  display: flex;
  align-items: center;
  gap: 20px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 5px;
  height: 100%;
  transition: width 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.stat-card:hover::before {
  width: 100%;
  opacity: 0.05;
}

.stat-upcoming::before {
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
}

.stat-completed::before {
  background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
}

.stat-overdue::before {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
}

.stat-total::before {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-icon {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: white;
}

.stat-upcoming .stat-icon {
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
}

.stat-completed .stat-icon {
  background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
}

.stat-overdue .stat-icon {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
}

.stat-total .stat-icon {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-content h3 {
  font-size: 32px;
  font-weight: 800;
  margin: 0;
  color: #2c3e50;
}

.stat-content p {
  font-size: 14px;
  color: #636e72;
  margin: 5px 0 0 0;
}

/* Vaccines Section */
.vaccines-section {
  margin-bottom: 40px;
}

.section-title {
  font-size: 24px;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title i {
  color: #00b4d8;
}

/* Vaccines Grid */
.vaccines-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 25px;
}

/* Vaccine Card */
.vaccine-card {
  background: white;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  position: relative;
}

.vaccine-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.vaccine-card-header {
  padding: 20px;
  background: linear-gradient(135deg, rgba(0, 180, 216, 0.1) 0%, rgba(0, 119, 182, 0.1) 100%);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 3px solid;
}

.vaccine-upcoming .vaccine-card-header {
  border-bottom-color: #00b4d8;
}

.vaccine-past .vaccine-card-header {
  border-bottom-color: #0ba360;
}

.vaccine-type-badge {
  font-size: 18px;
  font-weight: 700;
  color: #0077b6;
}

.vaccine-status {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

.status-scheduled {
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
  color: white;
}

.status-completed {
  background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
  color: white;
}

.status-overdue {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
  color: white;
}

.vaccine-card-body {
  padding: 20px;
}

.vaccine-info {
  margin-bottom: 15px;
}

.info-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  color: #2c3e50;
  font-size: 14px;
}

.info-row i {
  color: #00b4d8;
  width: 20px;
  font-size: 14px;
}

.vaccine-countdown {
  background: linear-gradient(135deg, rgba(0, 180, 216, 0.1) 0%, rgba(0, 119, 182, 0.1) 100%);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  margin-top: 15px;
}

.countdown-number {
  display: block;
  font-size: 32px;
  font-weight: 800;
  color: #00b4d8;
}

.countdown-text {
  font-size: 14px;
  color: #636e72;
}

.vaccine-notes {
  margin-top: 15px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 3px solid #00b4d8;
}

.vaccine-notes i {
  color: #00b4d8;
  margin-right: 8px;
}

.vaccine-notes p {
  margin: 5px 0 0 0;
  font-size: 13px;
  color: #636e72;
}

.vaccine-card-footer {
  padding: 15px 20px;
  background: #f8f9fa;
  display: flex;
  gap: 10px;
  border-top: 1px solid #e9ecef;
}

.card-btn {
  flex: 1;
  padding: 10px 16px;
  border-radius: 8px;
  text-decoration: none;
  text-align: center;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.btn-edit {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-edit:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.btn-delete {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
  color: white;
}

.btn-delete:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 80px 20px;
  background: white;
  border-radius: 20px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
}

.empty-icon {
  font-size: 80px;
  color: #00b4d8;
  margin-bottom: 20px;
  opacity: 0.5;
}

.empty-state h3 {
  font-size: 24px;
  color: #2c3e50;
  margin-bottom: 10px;
}

.empty-state p {
  font-size: 16px;
  color: #636e72;
  margin-bottom: 30px;
}

.btn-empty-action {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 16px 32px;
  background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
  color: white;
  text-decoration: none;
  border-radius: 25px;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 180, 216, 0.3);
}

.btn-empty-action:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 180, 216, 0.5);
}

/* Responsive Design */
@media (max-width: 768px) {
  .vaccine-schedule-page {
    padding: 30px 20px;
  }

  .schedule-header h2 {
    font-size: 32px;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  .vaccines-grid {
    grid-template-columns: 1fr;
  }

  .schedule-actions {
    flex-direction: column;
  }

  .action-btn {
    width: 100%;
    justify-content: center;
  }

  .filter-options {
    flex-direction: column;
  }

  .filter-select {
    width: 100%;
  }
}
</style>

<!-- JavaScript -->
<script>
// Toggle Filter Panel
function toggleFilters() {
  const panel = document.getElementById('filterPanel');
  if (panel.style.display === 'none') {
    panel.style.display = 'block';
  } else {
    panel.style.display = 'none';
  }
}

// Apply Filters
function applyFilters() {
  const statusFilter = document.getElementById('statusFilter').value;
  const memberFilter = document.getElementById('memberFilter').value;

  const cards = document.querySelectorAll('.vaccine-card');

  cards.forEach(card => {
    let showCard = true;

    // Filter by status
    if (statusFilter !== 'all') {
      const cardStatus = card.getAttribute('data-status');
      if (cardStatus !== statusFilter) {
        showCard = false;
      }
    }

    // Show or hide card
    if (showCard) {
      card.style.display = 'block';
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, 10);
    } else {
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      setTimeout(() => {
        card.style.display = 'none';
      }, 300);
    }
  });
}

// Clear Filters
function clearFilters() {
  document.getElementById('statusFilter').value = 'all';
  document.getElementById('memberFilter').value = 'all';

  const cards = document.querySelectorAll('.vaccine-card');
  cards.forEach(card => {
    card.style.display = 'block';
    card.style.opacity = '1';
    card.style.transform = 'translateY(0)';
  });
}

// Animation on load
document.addEventListener('DOMContentLoaded', function() {
  const cards = document.querySelectorAll('.vaccine-card');
  cards.forEach((card, index) => {
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    setTimeout(() => {
      card.style.transition = 'all 0.5s ease';
      card.style.opacity = '1';
      card.style.transform = 'translateY(0)';
    }, index * 100);
  });
});
</script>

{% endblock %}